{"version":3,"file":"mithril-dialog.js","sources":["../src/lib/jquery.js","../src/components/modal.js","../src/components/close-button.js","../src/components/modal-header.js","../src/components/modal-body.js","../src/components/modal-footer.js","../src/lib/unique-id.js","../src/lib/options.js","../src/lib/handlers.js","../src/main.js"],"sourcesContent":["let g = null;\nlet w = null;\n\n/* eslint-disable no-undef, no-empty */\ntry {\n  g = global;\n}\ncatch (err) {}\n\ntry {\n  w = window;\n}\ncatch (err) {}\n/* eslint-enable no-undef, no-empty */\n\nexport default (g || w).jQuery || (g || w).$;\n","import m from 'mithril';\nimport $ from '../lib/jquery.js';\n\nexport default {\n  view: (vnode) => {\n    let instanceId  = vnode.attrs.instanceId;\n    let options     = vnode.attrs.options;\n    return m('.modal', {\n      id:                 instanceId,\n      class:              !options.fade ? '' : 'fade',\n      tabindex:           '-1',\n      role:               'dialog',\n      'aria-hidden':      'true',\n      'aria-labelledby':  `${instanceId}_title`,\n      'aria-describedby': options.description,\n    }, m('.modal-dialog', {\n      class:              !options.large ? '' : 'modal-lg',\n      role:               'document'\n    }, m('.modal-content', vnode.children)));\n  }\n};\n","import m from 'mithril';\n\nexport default {\n  view: (vnode) => {\n    let instanceId  = vnode.attrs.instanceId;\n    let options     = vnode.attrs.options;\n    return m('button.close[type=\"button\"]', {\n      'data-dismiss':         'modal',\n      'aria-label':           options.closeButtonLabel || 'Close',\n    }, m('span[aria-hidden=\"true\"]', m.trust('&times;')));\n  }\n};\n","import m from 'mithril';\nimport CloseButton from './close-button.js';\n\nexport default {\n  view: (vnode) => {\n    let instanceId  = vnode.attrs.instanceId;\n    let options     = vnode.attrs.options;\n    return m('.modal-header',\n      m('h5.modal-title', {\n        id:               instanceId + '_title',\n      }, options.title),\n      m(CloseButton, { instanceId, options }),\n    );\n  }\n};\n","import m from 'mithril';\n\nexport default {\n  view: (vnode) => {\n    let instanceId  = vnode.attrs.instanceId;\n    let options     = vnode.attrs.options;\n    return m('.modal-body', vnode.children);\n  }\n};\n","import m from 'mithril';\n\nexport default {\n  view: (vnode) => {\n    let instanceId  = vnode.attrs.instanceId;\n    let options     = vnode.attrs.options;\n    return m('.modal-footer', vnode.children);\n  }\n};\n","let _uniqueId_counter = 0;\nconst MAX_VALUE = 10000000000;\n\nexport default function(prefix) {\n  _uniqueId_counter++;\n  if (_uniqueId_counter >= MAX_VALUE) {\n    _uniqueId_counter = 0;\n  }\n  return `_${prefix || ''}${Date.now()}_${_uniqueId_counter}`;\n}\n","export function boolOption(options, property, defaultValue) {\n  return options.hasOwnProperty(property) ? options[property] : defaultValue;\n}\n\nexport function getOptions(options) {\n  options = options || {};\n  return {\n    title:              options.title || '',\n    description:        options.description || '',\n    fade:               boolOption(options, 'fade', true),\n    large:              boolOption(options, 'large', false),\n    closeButton:        boolOption(options, 'closeButton', true),\n    enterCommits:       boolOption(options, 'enterCommits', true),\n    closeButtonLabel:   options.closeButtonLabel || null,\n    before:             options.before || null,\n    after:              options.after || null,\n    footer:             options.footer || null,\n    modalView:          options.modalView || null,\n    headerView:         options.headerView || null,\n    bodyView:           options.bodyView || null,\n    footerView:         options.footerView || null,\n  };\n}\n","import $ from './jquery.js';\nimport { boolOption } from './options.js';\n\nexport const ignoredElementNames = [\n  'SELECT',\n  'TEXTAREA',\n];\n\nconst ENTER_KEY = 13;\n\nexport function attachHandlers(vnode) {\n  let $modal        = $(vnode.dom);\n  let options       = vnode.attrs.dialog || {};\n  let enterCommits  = boolOption(options, 'enterCommits', true);\n  if (enterCommits) {\n    $modal.on('keypress', (event) => {\n      let target  = event.target;\n      let ignored = ignoredElementNames.indexOf(target.nodeName) > -1;\n      if (!ignored && event.keyCode === ENTER_KEY) {\n        vnode.state.close(event, true);\n        m.redraw();\n      }\n    });\n  }\n  $modal.on('shown.bs.modal', (event) => {\n    vnode.state.visible = true;\n    $modal.find('.autofocus').focus();\n  });\n  $modal.on('hide.bs.modal', (event) => {\n    // console.log('modal hide.bs.modal', vnode.attrs.dialog.model, event, {state: vnode.state, attrs: vnode.attrs});\n    vnode.state.close(event, false);\n    vnode.state.visible = false;\n  });\n}\n","import m from 'mithril';\n\nimport Modal from './components/modal.js';\nimport ModalHeader from './components/modal-header.js';\nimport ModalBody from './components/modal-body.js';\nimport ModalFooter from './components/modal-footer.js';\n\nimport $ from './lib/jquery.js';\nimport uniqueId from './lib/unique-id.js';\nimport { getOptions } from './lib/options.js';\nimport { attachHandlers } from './lib/handlers.js';\n\nconst MODAL_REMOVE_FALLBACK_DELAY = 1500;\n\nexport default {\n  Modal,\n  ModalHeader,\n  ModalBody,\n  ModalFooter,\n\n  MODAL_REMOVE_FALLBACK_DELAY,\n\n  oninit: (vnode) => {\n    // console.log('modal oninit');\n    vnode.state.instanceId    = uniqueId('dialog');\n    vnode.state.visible       = false;\n    vnode.state.transitioning = false;\n    vnode.state.close = (event, saved) => {\n      if (vnode.state.visible) {\n        if (vnode.attrs.dialog.onclose) {\n          vnode.attrs.dialog.onclose(event, saved);\n        }\n        // unless close prevented, update visibility\n        if (!event.defaultPrevented) {\n          vnode.attrs.dialog.model  = null;\n        }\n      }\n    };\n    vnode.state.refresh = (model) => {\n      let stateVisibility       = vnode.state.visible;\n      let configuredVisibility  = !!model;\n      // console.log('modal refresh', {model, stateVisibility, configuredVisibility});\n      if (stateVisibility !== configuredVisibility) {\n        try {\n          $(vnode.dom).modal(configuredVisibility ? 'show' : 'hide');\n        }\n        catch (err) {\n          console.debug(err.stack || err);\n        }\n      }\n    };\n  },\n\n  oncreate: (vnode) => {\n    // console.log('oncreate', vnode.attrs.dialog.model, {state: vnode.state, attrs: vnode.attrs});\n    attachHandlers(vnode);\n    vnode.state.refresh(vnode.attrs.dialog.model);\n  },\n\n  onupdate: (vnode) => {\n    // console.log('onupdate', vnode.attrs.dialog.model, {state: vnode.state, attrs: vnode.attrs});\n    vnode.state.refresh(vnode.attrs.dialog.model);\n  },\n\n  onbeforeremove: (vnode) => {\n    let $modal = $(vnode.dom);\n    return new Promise((resolve, reject) => {\n      let fallback = setTimeout(() => resolve(), MODAL_REMOVE_FALLBACK_DELAY);\n      $modal.on('hidden.bs.modal', () => {\n        clearTimeout(fallback);\n        resolve();\n      });\n    });\n  },\n\n  view: (vnode) => {\n    let instanceId  = vnode.state.instanceId;\n    let options     = getOptions(vnode.attrs.dialog);\n    // console.log('options', options);\n    return m(options.modalView || Modal, { instanceId, options }, [\n      m(options.headerView || ModalHeader, { instanceId, options }),\n      options.before,\n      m(options.bodyView || ModalBody, { instanceId, options }, vnode.children),\n      options.after,\n      m(options.footerView || ModalFooter, { instanceId, options }, options.footer),\n    ]);\n  }\n}\n"],"names":["g","w","global","err","window","jQuery","$","vnode","instanceId","attrs","options","m","fade","description","large","children","closeButtonLabel","trust","title","CloseButton","_uniqueId_counter","MAX_VALUE","prefix","Date","now","boolOption","property","defaultValue","hasOwnProperty","getOptions","before","after","footer","modalView","headerView","bodyView","footerView","ignoredElementNames","ENTER_KEY","attachHandlers","$modal","dom","dialog","enterCommits","on","event","target","ignored","indexOf","nodeName","keyCode","state","close","redraw","visible","find","focus","MODAL_REMOVE_FALLBACK_DELAY","uniqueId","transitioning","saved","onclose","defaultPrevented","model","refresh","stateVisibility","configuredVisibility","modal","debug","stack","Promise","resolve","reject","fallback","setTimeout","Modal","ModalHeader","ModalBody","ModalFooter"],"mappings":";;;;;;AAAA,IAAIA,IAAI,IAAR;AACA,IAAIC,IAAI,IAAR;;;AAGA,IAAI;MACEC,MAAJ;CADF,CAGA,OAAOC,GAAP,EAAY;;AAEZ,IAAI;MACEC,MAAJ;CADF,CAGA,OAAOD,GAAP,EAAY;;;AAGZ,QAAe,CAACH,KAAKC,CAAN,EAASI,MAAT,IAAmB,CAACL,KAAKC,CAAN,EAASK,CAA3C;;ACZA,YAAe;QACP,cAACC,KAAD,EAAW;QACXC,aAAcD,MAAME,KAAN,CAAYD,UAA9B;QACIE,UAAcH,MAAME,KAAN,CAAYC,OAA9B;WACOC,IAAE,QAAF,EAAY;UACGH,UADH;aAEG,CAACE,QAAQE,IAAT,GAAgB,EAAhB,GAAqB,MAFxB;gBAGG,IAHH;YAIG,QAJH;qBAKG,MALH;yBAMMJ,UAAvB,WANiB;0BAOGE,QAAQG;KAPvB,EAQJF,IAAE,eAAF,EAAmB;aACA,CAACD,QAAQI,KAAT,GAAiB,EAAjB,GAAsB,UADtB;YAEA;KAFnB,EAGAH,IAAE,gBAAF,EAAoBJ,MAAMQ,QAA1B,CAHA,CARI,CAAP;;CAJJ;;ACDA,kBAAe;QACP,cAACR,KAAD,EAAW;QACXC,aAAcD,MAAME,KAAN,CAAYD,UAA9B;QACIE,UAAcH,MAAME,KAAN,CAAYC,OAA9B;WACOC,IAAE,6BAAF,EAAiC;sBACd,OADc;oBAEdD,QAAQM,gBAAR,IAA4B;KAF/C,EAGJL,IAAE,0BAAF,EAA8BA,IAAEM,KAAF,CAAQ,SAAR,CAA9B,CAHI,CAAP;;CAJJ;;ACCA,kBAAe;QACP,cAACV,KAAD,EAAW;QACXC,aAAcD,MAAME,KAAN,CAAYD,UAA9B;QACIE,UAAcH,MAAME,KAAN,CAAYC,OAA9B;WACOC,IAAE,eAAF,EACLA,IAAE,gBAAF,EAAoB;UACAH,aAAa;KADjC,EAEGE,QAAQQ,KAFX,CADK,EAILP,IAAEQ,WAAF,EAAe,EAAEX,sBAAF,EAAcE,gBAAd,EAAf,CAJK,CAAP;;CAJJ;;ACDA,gBAAe;QACP,cAACH,KAAD,EAAW;QACXC,aAAcD,MAAME,KAAN,CAAYD,UAA9B;QACIE,UAAcH,MAAME,KAAN,CAAYC,OAA9B;WACOC,IAAE,aAAF,EAAiBJ,MAAMQ,QAAvB,CAAP;;CAJJ;;ACAA,kBAAe;QACP,cAACR,KAAD,EAAW;QACXC,aAAcD,MAAME,KAAN,CAAYD,UAA9B;QACIE,UAAcH,MAAME,KAAN,CAAYC,OAA9B;WACOC,IAAE,eAAF,EAAmBJ,MAAMQ,QAAzB,CAAP;;CAJJ;;ACFA,IAAIK,oBAAoB,CAAxB;AACA,IAAMC,YAAY,WAAlB;;AAEA,eAAe,UAASC,MAAT,EAAiB;;MAE1BF,qBAAqBC,SAAzB,EAAoC;wBACd,CAApB;;gBAESC,UAAU,EAArB,IAA0BC,KAAKC,GAAL,EAA1B,SAAwCJ,iBAAxC;;;ACRK,SAASK,UAAT,CAAoBf,OAApB,EAA6BgB,QAA7B,EAAuCC,YAAvC,EAAqD;SACnDjB,QAAQkB,cAAR,CAAuBF,QAAvB,IAAmChB,QAAQgB,QAAR,CAAnC,GAAuDC,YAA9D;;;AAGF,AAAO,SAASE,UAAT,CAAoBnB,OAApB,EAA6B;YACxBA,WAAW,EAArB;SACO;WACeA,QAAQQ,KAAR,IAAiB,EADhC;iBAEeR,QAAQG,WAAR,IAAuB,EAFtC;UAGeY,WAAWf,OAAX,EAAoB,MAApB,EAA4B,IAA5B,CAHf;WAIee,WAAWf,OAAX,EAAoB,OAApB,EAA6B,KAA7B,CAJf;iBAKee,WAAWf,OAAX,EAAoB,aAApB,EAAmC,IAAnC,CALf;kBAMee,WAAWf,OAAX,EAAoB,cAApB,EAAoC,IAApC,CANf;sBAOeA,QAAQM,gBAAR,IAA4B,IAP3C;YAQeN,QAAQoB,MAAR,IAAkB,IARjC;WASepB,QAAQqB,KAAR,IAAiB,IAThC;YAUerB,QAAQsB,MAAR,IAAkB,IAVjC;eAWetB,QAAQuB,SAAR,IAAqB,IAXpC;gBAYevB,QAAQwB,UAAR,IAAsB,IAZrC;cAaexB,QAAQyB,QAAR,IAAoB,IAbnC;gBAcezB,QAAQ0B,UAAR,IAAsB;GAd5C;;;ACHK,IAAMC,sBAAsB,CACjC,QADiC,EAEjC,UAFiC,CAA5B;;AAKP,IAAMC,YAAY,EAAlB;;AAEA,AAAO,SAASC,cAAT,CAAwBhC,KAAxB,EAA+B;MAChCiC,SAAgBlC,EAAEC,MAAMkC,GAAR,CAApB;MACI/B,UAAgBH,MAAME,KAAN,CAAYiC,MAAZ,IAAsB,EAA1C;MACIC,eAAgBlB,WAAWf,OAAX,EAAoB,cAApB,EAAoC,IAApC,CAApB;MACIiC,YAAJ,EAAkB;WACTC,EAAP,CAAU,UAAV,EAAsB,UAACC,KAAD,EAAW;UAC3BC,SAAUD,MAAMC,MAApB;UACIC,UAAUV,oBAAoBW,OAApB,CAA4BF,OAAOG,QAAnC,IAA+C,CAAC,CAA9D;UACI,CAACF,OAAD,IAAYF,MAAMK,OAAN,KAAkBZ,SAAlC,EAA6C;cACrCa,KAAN,CAAYC,KAAZ,CAAkBP,KAAlB,EAAyB,IAAzB;UACEQ,MAAF;;KALJ;;SASKT,EAAP,CAAU,gBAAV,EAA4B,UAACC,KAAD,EAAW;UAC/BM,KAAN,CAAYG,OAAZ,GAAsB,IAAtB;WACOC,IAAP,CAAY,YAAZ,EAA0BC,KAA1B;GAFF;SAIOZ,EAAP,CAAU,eAAV,EAA2B,UAACC,KAAD,EAAW;;UAE9BM,KAAN,CAAYC,KAAZ,CAAkBP,KAAlB,EAAyB,KAAzB;UACMM,KAAN,CAAYG,OAAZ,GAAsB,KAAtB;GAHF;;;AChBF,IAAMG,8BAA8B,IAApC;;AAEA,WAAe;cAAA;0BAAA;sBAAA;0BAAA;;0DAAA;;UAQL,gBAAClD,KAAD,EAAW;;UAEX4C,KAAN,CAAY3C,UAAZ,GAA4BkD,SAAS,QAAT,CAA5B;UACMP,KAAN,CAAYG,OAAZ,GAA4B,KAA5B;UACMH,KAAN,CAAYQ,aAAZ,GAA4B,KAA5B;UACMR,KAAN,CAAYC,KAAZ,GAAoB,UAACP,KAAD,EAAQe,KAAR,EAAkB;UAChCrD,MAAM4C,KAAN,CAAYG,OAAhB,EAAyB;YACnB/C,MAAME,KAAN,CAAYiC,MAAZ,CAAmBmB,OAAvB,EAAgC;gBACxBpD,KAAN,CAAYiC,MAAZ,CAAmBmB,OAAnB,CAA2BhB,KAA3B,EAAkCe,KAAlC;;;YAGE,CAACf,MAAMiB,gBAAX,EAA6B;gBACrBrD,KAAN,CAAYiC,MAAZ,CAAmBqB,KAAnB,GAA4B,IAA5B;;;KAPN;UAWMZ,KAAN,CAAYa,OAAZ,GAAsB,UAACD,KAAD,EAAW;UAC3BE,kBAAwB1D,MAAM4C,KAAN,CAAYG,OAAxC;UACIY,uBAAwB,CAAC,CAACH,KAA9B;;UAEIE,oBAAoBC,oBAAxB,EAA8C;YACxC;YACA3D,MAAMkC,GAAR,EAAa0B,KAAb,CAAmBD,uBAAuB,MAAvB,GAAgC,MAAnD;SADF,CAGA,OAAO/D,GAAP,EAAY;kBACFiE,KAAR,CAAcjE,IAAIkE,KAAJ,IAAalE,GAA3B;;;KATN;GAxBW;;YAuCH,kBAACI,KAAD,EAAW;;mBAEJA,KAAf;UACM4C,KAAN,CAAYa,OAAZ,CAAoBzD,MAAME,KAAN,CAAYiC,MAAZ,CAAmBqB,KAAvC;GA1CW;;YA6CH,kBAACxD,KAAD,EAAW;;UAEb4C,KAAN,CAAYa,OAAZ,CAAoBzD,MAAME,KAAN,CAAYiC,MAAZ,CAAmBqB,KAAvC;GA/CW;;kBAkDG,wBAACxD,KAAD,EAAW;QACrBiC,SAASlC,EAAEC,MAAMkC,GAAR,CAAb;WACO,IAAI6B,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;UAClCC,WAAWC,WAAW;eAAMH,SAAN;OAAX,EAA4Bd,2BAA5B,CAAf;aACOb,EAAP,CAAU,iBAAV,EAA6B,YAAM;qBACpB6B,QAAb;;OADF;KAFK,CAAP;GApDW;;QA6DP,cAAClE,KAAD,EAAW;QACXC,aAAcD,MAAM4C,KAAN,CAAY3C,UAA9B;QACIE,UAAcmB,WAAWtB,MAAME,KAAN,CAAYiC,MAAvB,CAAlB;;WAEO/B,IAAED,QAAQuB,SAAR,IAAqB0C,KAAvB,EAA8B,EAAEnE,sBAAF,EAAcE,gBAAd,EAA9B,EAAuD,CAC5DC,IAAED,QAAQwB,UAAR,IAAsB0C,WAAxB,EAAqC,EAAEpE,sBAAF,EAAcE,gBAAd,EAArC,CAD4D,EAE5DA,QAAQoB,MAFoD,EAG5DnB,IAAED,QAAQyB,QAAR,IAAoB0C,SAAtB,EAAiC,EAAErE,sBAAF,EAAcE,gBAAd,EAAjC,EAA0DH,MAAMQ,QAAhE,CAH4D,EAI5DL,QAAQqB,KAJoD,EAK5DpB,IAAED,QAAQ0B,UAAR,IAAsB0C,WAAxB,EAAqC,EAAEtE,sBAAF,EAAcE,gBAAd,EAArC,EAA8DA,QAAQsB,MAAtE,CAL4D,CAAvD,CAAP;;CAjEJ;;;;"}